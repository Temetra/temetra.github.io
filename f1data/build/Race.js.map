{"version":3,"file":"Race.js","sources":["../../src/components/Race.svelte"],"sourcesContent":["<script lang=\"ts\">\r\n\timport type { JoinedRace, RaceResult } from \"+/modules/types\";\r\n\timport { storedDb as db } from \"+/stores/datastore\";\r\n\timport { getJoinedRaces } from \"+/modules/queries/measured\";\r\n\timport { getResults } from \"+/modules/queries/measured\";\r\n\timport { formatDate, hexToLuma } from \"+/modules/shared\";\r\n\r\n\timport SectionTemplate from \"+/components/SectionTemplate.svelte\";\r\n\r\n\texport let params: { year: number, round: number };\r\n\r\n\tlet races: JoinedRace[], \r\n\t\trace: JoinedRace,\r\n\t\tresults: RaceResult[];\r\n\r\n\t$: if (params.year) races = getJoinedRaces($db, params.year);\r\n\t$: if (params.round && races) race = races.find(x => x.round == params.round);\r\n\t$: results = race ? getResults($db, race.raceId) : null;\r\n\r\n\tfunction color(node: HTMLElement, color: string) {\r\n\t\tif (color) {\r\n\t\t\tnode.style.backgroundColor = color;\r\n\t\t\tif (hexToLuma(color) < 200) node.style.borderColor = color;\r\n\t\t} else {\r\n\t\t\tnode.classList.add(\"no-team-color\");\r\n\t\t}\r\n\t\treturn { };\r\n\t}\r\n</script>\r\n\r\n<style type=\"text/scss\">\r\n\t:global(.no-team-color) {\r\n\t\tbackground: repeating-linear-gradient(\r\n\t\t\t45deg, \r\n\t\t\t#fff, \r\n\t\t\t#fff 4px, \r\n\t\t\t#ccc 4px, \r\n\t\t\t#ccc 8px\r\n\t\t);\r\n\t}\r\n\r\n\t.title {\r\n\t\tdisplay:flex;\r\n\t\twidth:100%;\r\n\r\n\t\t& :nth-child(1) {\r\n\t\t\tflex:auto;\r\n\t\t}\r\n\r\n\t\t& :nth-child(2) {\r\n\t\t\tflex:initial;\r\n\t\t}\r\n\t}\r\n\r\n\ttable {\r\n\t\twidth:100%;\r\n\r\n\t\tth, td {\r\n\t\t\ttext-align:center;\r\n\r\n\t\t\t&:nth-child(1),\r\n\t\t\t&:nth-child(2) {\r\n\t\t\t\ttext-align:left;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttd.team {\r\n\t\t\tdisplay:flex;\r\n\t\t\talign-items:center;\r\n\r\n\t\t\tdiv {\r\n\t\t\t\theight:16px;\r\n\t\t\t\twidth:16px;\r\n\t\t\t\tborder:solid 1px #a0a0a0;\r\n\t\t\t\tmargin-right:4px;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n\r\n<SectionTemplate>\r\n\t<div class=\"title\" slot=\"header\">\r\n\t\t{#if race}\r\n\t\t\t<div>{race.year} {race.title}, Round {race.round}</div>\r\n\t\t\t<div>{formatDate(race?.when)}</div>\r\n\t\t{:else}\r\n\t\t\tNo race\r\n\t\t{/if}\r\n\t</div>\r\n\t\r\n\t{#if results?.length > 0}\r\n\t\t<table>\r\n\t\t\t<tr>\r\n\t\t\t\t<th>Driver</th>\r\n\t\t\t\t<th>Constructor</th>\r\n\t\t\t\t<th>Grid</th>\r\n\t\t\t\t<th>Position</th>\r\n\t\t\t\t<th>Laps</th>\r\n\t\t\t\t<th>Points</th>\r\n\t\t\t</tr>\r\n\t\t\t{#each results as result (result.resultId)}\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td>{result.forename} {result.surname}</td>\r\n\t\t\t\t\t<td class=\"team\"><div use:color={result.color}></div> {result.team}</td>\r\n\t\t\t\t\t<td>{result.grid}</td>\r\n\t\t\t\t\t<td>{result.position || result.status}</td>\r\n\t\t\t\t\t<td>{result.laps}</td>\r\n\t\t\t\t\t<td>{result.points}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t{/each}\r\n\t\t</table>\r\n\t{:else}\r\n\t\tNo results\r\n\t{/if}\r\n\r\n\t{#if races}\r\n\t\t<ul>\r\n\t\t\t{#each races as r}\r\n\t\t\t\t<li class:highlight={r.raceId == race?.raceId}>\r\n\t\t\t\t\t<a href=\"#/race/{r.year}/{r.round}\">{r.country}</a>\r\n\t\t\t\t</li>\r\n\t\t\t{/each}\r\n\t\t</ul>\r\n\t{/if}\r\n</SectionTemplate>\r\n"],"names":["ctx","length","forename","surname","team","grid","position","status","laps","points","color","country","year","round","raceId","_ctx$","_ctx$2","title","formatDate","_ctx$4","when","_ctx$5","races","race","results","params","getJoinedRaces","$db","find","x","getResults","node","style","backgroundColor","hexToLuma","borderColor","classList","add"],"mappings":"kgCAoGUA,0BAAmBA,uBAAxBC,8jBAAKD,8KAEAA,KAAOE,cAAWF,KAAOG,aACyBH,KAAOI,UACzDJ,KAAOK,WACPL,KAAOM,UAAYN,KAAOO,aAC1BP,KAAOQ,UACPR,KAAOS,6oBAJqBT,KAAOU,+CADnCV,KAAOE,iCAAWF,KAAOG,4DACGH,KAAOU,mBAAeV,KAAOI,6BACzDJ,KAAOK,8BACPL,KAAOM,UAAYN,KAAOO,gCAC1BP,KAAOQ,6BACPR,KAAOS,+EAUPT,kBAALC,0MAAKD,aAALC,2HAAAA,sEAEqCD,KAAEW,4FAAtBX,KAAEY,SAAOZ,KAAEa,uBADRb,KAAEc,mBAAUd,yBAAAe,EAAMD,4FACDd,KAAEW,0CAAtBX,KAAEY,SAAOZ,KAAEa,4CADRb,KAAEc,mBAAUd,yBAAAgB,EAAMF,+FA5BrCd,2BAASC,QAAS,0BAyBlBD,2MAAAA,8QAhCGA,KAAKY,UAAOZ,KAAKiB,WAAejB,KAAKa,WACrCK,YAAWlB,yBAAAmB,EAAMC,8RADjBpB,KAAKY,6BAAOZ,KAAKiB,8BAAejB,KAAKa,8BACrCK,YAAWlB,yBAAAqB,EAAMD,sGAFnBpB,8qBAvEFsB,EACHC,EACAC,EAJUC,IAAAA,uGAMJA,EAAOb,UAAMU,EAAQI,EAAeC,EAAKF,EAAOb,sBAChDa,EAAOZ,OAASS,OAAOC,EAAOD,EAAMM,MAAK,SAAAC,UAAKA,EAAEhB,OAASY,EAAOZ,6BACpEW,EAAUD,EAAOO,EAAWH,EAAKJ,EAAKT,QAAU,uBAEpCiB,EAAmBrB,UAC7BA,GACHqB,EAAKC,MAAMC,gBAAkBvB,EACzBwB,EAAUxB,GAAS,MAAKqB,EAAKC,MAAMG,YAAczB,IAErDqB,EAAKK,UAAUC,IAAI"}